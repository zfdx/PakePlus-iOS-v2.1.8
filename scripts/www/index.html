<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>æ¿€æ´»ç ç”Ÿæˆå™¨ Â· å—ä¿æŠ¤</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
            margin: 0;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            padding: 24px 20px;
            width: 100%;
            max-width: 500px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        h2, h3 {
            text-align: center;
            color: #333;
            margin: 0 0 20px 0;
            font-weight: 600;
            letter-spacing: 0.5px;
            font-size: 1.6rem;
        }

        h3 {
            font-size: 1.4rem;
            margin-bottom: 16px;
            color: #555;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 6px;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 16px;
            font-size: 1rem;
            transition: 0.2s;
            background: white;
            -webkit-appearance: none;
            appearance: none;
        }

        input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .hint {
            font-size: 0.8rem;
            color: #888;
            margin-top: 6px;
        }

        .quick-selectors {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
            justify-content: center;
        }

        .selector {
            flex: 1 0 auto;
            background: #edf2f7;
            color: #4a5568;
            padding: 10px 12px;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 600;
            border: 2px solid transparent;
            cursor: pointer;
            transition: 0.2s;
            min-width: 70px;
            text-align: center;
            touch-action: manipulation;
        }

        .selector:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
        }

        .selector.active {
            background: #667eea;
            color: white;
            border-color: #5a67d8;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin: 24px 0 16px;
            flex-wrap: wrap;
        }

        @media (max-width: 480px) {
            .button-group {
                flex-direction: column;
                gap: 10px;
            }
            .quick-selectors {
                gap: 6px;
            }
            .selector {
                padding: 8px 6px;
                font-size: 0.8rem;
            }
        }

        button {
            flex: 1 1 auto;
            background: #667eea;
            border: none;
            color: white;
            padding: 16px 12px;
            border-radius: 40px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
            min-width: 120px;
            touch-action: manipulation;
        }

        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .result-area {
            background: #f7fafc;
            border-radius: 20px;
            padding: 18px 14px;
            border: 2px dashed #cbd5e0;
            text-align: center;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            color: #2d3748;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.4;
        }

        .error-message {
            color: #e53e3e;
            font-size: 0.9rem;
            text-align: center;
            margin-top: 10px;
            min-height: 24px;
        }

        .hidden {
            display: none;
        }

        /* è‡ªå®šä¹‰è½»æç¤ºæ ·å¼ */
        .copy-toast {
            margin: 12px 0;  /* ä¸Šä¸‹é—´è·è°ƒæ•´ä¸º12pxï¼Œä½¿å…¶ç´§è´´æŒ‰é’®ä¸‹æ–¹ */
            padding: 10px 16px;
            border-radius: 40px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 500;
            color: white;
            transition: opacity 0.2s;
        }
        .copy-toast.success {
            background: #48bb78;
        }
        .copy-toast.error {
            background: #e53e3e;
        }
        .copy-toast.hidden {
            display: none;
        }

        @media (max-width: 360px) {
            .card {
                padding: 20px 16px;
            }
            h2 {
                font-size: 1.4rem;
            }
            button {
                padding: 14px 10px;
                font-size: 1rem;
            }
            .selector {
                font-size: 0.75rem;
                padding: 8px 4px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <div class="card">
        <div id="passwordSection">
            <h3>ğŸ”’ è¯·è¾“å…¥è®¿é—®å¯†ç </h3>
            <div class="input-group">
                <input type="password" id="passwordInput" placeholder="å¯†ç " autofocus>
            </div>
            <div class="button-group" style="margin-top:10px;">
                <button id="passwordSubmit">è¿›å…¥</button>
            </div>
            <div id="passwordError" class="error-message"></div>
        </div>

        <div id="generatorSection" class="hidden">
            <h2>ğŸ” æ¿€æ´»ç ç”Ÿæˆå™¨</h2>

            <div class="input-group">
                <label>ID <span>(æ•´æ•°)</span></label>
                <input type="number" id="idInput" placeholder="è¯·è¾“å…¥ID">
            </div>

            <div class="input-group">
                <label>ğŸ“… å¿«æ·æœ‰æ•ˆæœŸ</label>
                <div class="quick-selectors" id="quickSelectors">
                    <button class="selector" data-days="1">æµ‹è¯•1å¤©</button>
                    <button class="selector" data-days="7">å‘¨å¡7å¤©</button>
                    <button class="selector" data-days="30">æœˆå¡30å¤©</button>
                    <button class="selector" data-days="90">å­£å¡90å¤©</button>
                    <button class="selector" data-days="365">å¹´å¡365å¤©</button>
                    <button class="selector" data-days="0">æ°¸ä¹…å¡</button>
                </div>
            </div>

            <div class="input-group">
                <label>âœï¸ è‡ªå®šä¹‰å¤©æ•° <span>(0 è¡¨ç¤ºæ°¸ä¹…)</span></label>
                <input type="number" id="daysInput" placeholder="è¾“å…¥å¤©æ•°" min="0" value="1">
                <div class="hint">å¤©æ•°å°†è½¬æ¢ä¸ºæ¯«ç§’ï¼Œé™„åŠ åœ¨æ¿€æ´»ç ä¸­ï¼›0 ä¸ºæ°¸ä¹…æ— æœŸé™</div>
            </div>

            <!-- ä»…å‰©ç”ŸæˆæŒ‰é’® -->
            <div class="button-group">
                <button id="generateBtn">âœ¨ ç”Ÿæˆæ¿€æ´»ç </button>
            </div>

            <!-- è½»æç¤ºå·²ç§»åŠ¨åˆ°æŒ‰é’®ä¸‹æ–¹ï¼Œç»“æœåŒºåŸŸä¸Šæ–¹ -->
            <div id="copyToast" class="copy-toast hidden"></div>

            <div class="result-area" id="resultDisplay">âœ¨ ç‚¹å‡»ã€ç”Ÿæˆæ¿€æ´»ç ã€‘</div>
        </div>
    </div>

    <script>
        (function() {
            // ---------- å›ºå®šå‚æ•° ----------
            const KEY_STRING = "Format2044153997";
            const KEY = CryptoJS.enc.Utf8.parse(KEY_STRING);
            const FIXED_KEY = 9411741;

            // ---------- è·å–å…ƒç´  ----------
            const passwordSection = document.getElementById('passwordSection');
            const generatorSection = document.getElementById('generatorSection');
            const passwordInput = document.getElementById('passwordInput');
            const passwordSubmit = document.getElementById('passwordSubmit');
            const passwordError = document.getElementById('passwordError');

            const idInput = document.getElementById('idInput');
            const daysInput = document.getElementById('daysInput');
            const resultDisplay = document.getElementById('resultDisplay');
            const generateBtn = document.getElementById('generateBtn');
            const selectorButtons = document.querySelectorAll('.selector');
            const copyToast = document.getElementById('copyToast');

            let currentCode = '';

            // ---------- å¯†ç éªŒè¯ ----------
            const CORRECT_PASSWORD = "199612";

            passwordSubmit.addEventListener('click', function() {
                const entered = passwordInput.value;
                if (entered === CORRECT_PASSWORD) {
                    passwordSection.classList.add('hidden');
                    generatorSection.classList.remove('hidden');
                    passwordError.textContent = '';
                    idInput.focus();
                    // è¿›å…¥åé‡ç½®æ˜¾ç¤ºæç¤ºï¼ˆä¸è‡ªåŠ¨ç”Ÿæˆï¼‰
                    resultDisplay.textContent = 'âœ¨ ç‚¹å‡»ã€ç”Ÿæˆæ¿€æ´»ç ã€‘';
                    currentCode = '';
                } else {
                    passwordError.textContent = 'âŒ å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥';
                    passwordInput.value = '';
                    passwordInput.focus();
                }
            });

            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    passwordSubmit.click();
                }
            });

            // ---------- ç”Ÿæˆé€»è¾‘ ----------
            function generateActivationCode() {
                const idStr = idInput.value.trim();
                if (idStr === '') {
                    return '';
                }

                const idVal = parseInt(idStr, 10);
                if (isNaN(idVal)) {
                    return '';
                }

                let daysVal = daysInput.value.trim() === '' ? 0 : parseInt(daysInput.value, 10);
                if (isNaN(daysVal) || daysVal < 0) {
                    daysVal = 0;
                }

                const i3 = Math.floor(idVal / 2) + FIXED_KEY;
                const i3Hex = i3.toString(16);

                let plainText = i3Hex;
                if (daysVal > 0) {
                    const millis = daysVal * 86400000;
                    plainText = i3Hex + 'z' + millis;
                }

                const encrypted = CryptoJS.AES.encrypt(plainText, KEY, {
                    mode: CryptoJS.mode.ECB,
                    padding: CryptoJS.pad.Pkcs7
                });

                return encrypted.ciphertext.toString(CryptoJS.enc.Hex);
            }

            // ---------- è‡ªå®šä¹‰è½»æç¤ºï¼ˆæ›¿ä»£alertï¼‰----------
            function showToast(message, isError = false) {
                copyToast.textContent = message;
                copyToast.classList.remove('hidden', 'success', 'error');
                copyToast.classList.add(isError ? 'error' : 'success');
                // 2ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => {
                    copyToast.classList.add('hidden');
                }, 2000);
            }

            // ---------- å¤åˆ¶åˆ°å‰ªè´´æ¿å‡½æ•° ----------
            function copyToClipboard(text) {
                return navigator.clipboard.writeText(text);
            }

            // ---------- æ›´æ–°ç»“æœå¹¶è‡ªåŠ¨å¤åˆ¶ ----------
            function updateResultAndCopy() {
                const code = generateActivationCode();
                currentCode = code;
                if (code) {
                    resultDisplay.textContent = code;
                    // è‡ªåŠ¨å¤åˆ¶
                    copyToClipboard(code)
                        .then(() => {
                            showToast('æ¿€æ´»ç å·²å¤åˆ¶');   // âœ… æˆåŠŸæç¤ºï¼šæ¿€æ´»ç å·²å¤åˆ¶
                        })
                        .catch(() => {
                            showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', true);
                        });
                } else {
                    resultDisplay.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆIDåç”Ÿæˆ';
                    // æ²¡æœ‰ç”Ÿæˆæœ‰æ•ˆç ï¼Œä¸æ¸…é™¤ä¹‹å‰çš„toastï¼Œä¹Ÿä¸å¤åˆ¶
                }
            }

            generateBtn.addEventListener('click', updateResultAndCopy);

            // ---------- é«˜äº®ç®¡ç† ----------
            function removeActiveClass() {
                selectorButtons.forEach(btn => btn.classList.remove('active'));
            }

            function setActiveByDay(dayValue) {
                removeActiveClass();
                if (dayValue === undefined || dayValue === null) return;
                const numericDay = typeof dayValue === 'number' ? dayValue : parseInt(dayValue, 10);
                if (isNaN(numericDay)) return;

                selectorButtons.forEach(btn => {
                    const btnDay = parseInt(btn.dataset.days, 10);
                    if (btnDay === numericDay) {
                        btn.classList.add('active');
                    }
                });
            }

            function syncActiveFromInput() {
                let rawValue = daysInput.value.trim();
                if (rawValue === '') {
                    setActiveByDay(0);
                } else {
                    const num = parseInt(rawValue, 10);
                    if (!isNaN(num) && num >= 0) {
                        setActiveByDay(num);
                    } else {
                        removeActiveClass();
                    }
                }
            }

            daysInput.addEventListener('input', syncActiveFromInput);

            // å¿«æ·æŒ‰é’®ä»…è®¾ç½®å¤©æ•°å’Œé«˜äº®ï¼Œä¸å†è‡ªåŠ¨ç”Ÿæˆ
            selectorButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const days = this.dataset.days;
                    daysInput.value = days;
                    syncActiveFromInput();
                });
            });

            // æŒ‰å›è½¦é”®è§¦å‘ç”ŸæˆæŒ‰é’®ï¼ˆåŒç‚¹å‡»æ•ˆæœï¼‰
            idInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    generateBtn.click();
                }
            });

            // ---------- åˆå§‹åŒ–é»˜è®¤å€¼ï¼šæµ‹è¯•1å¤©ï¼Œä»…æ˜¾ç¤ºæç¤º ----------
            daysInput.value = '1';
            setActiveByDay(1);
            resultDisplay.textContent = 'âœ¨ ç‚¹å‡»ã€ç”Ÿæˆæ¿€æ´»ç ã€‘';
        })();
    </script>
</body>
</html>