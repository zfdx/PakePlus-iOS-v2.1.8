<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>æ¿€æ´»ç ç”Ÿæˆå™¨ Â· ç»¿é‡æŠ¤çœ¼</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        /* ---------- å…¨å±€é‡ç½®ä¸æŠ¤çœ¼ç»¿è‰²ä¸»é¢˜ (æ‰€æœ‰ç´«è‰²è°ƒå·²ç§»é™¤) ---------- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            /* æŸ”å’ŒæŠ¤çœ¼ç»¿æ¸å˜ â€” ä½é¥±å’Œåº¦ã€ä½è“å…‰ */
            background: linear-gradient(145deg, #c0ddb0 0%, #a0c89a 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
            margin: 0;
        }

        .card {
            /* åŠé€æ˜æŸ”ç™½åº•è‰²ï¼Œç•¥å¸¦ç»¿è°ƒ */
            background: rgba(245, 255, 240, 0.9);
            border-radius: 32px;
            box-shadow: 0 25px 45px rgba(40, 90, 40, 0.25);
            padding: 24px 20px;
            width: 100%;
            max-width: 500px;
            backdrop-filter: blur(8px);
            transition: all 0.3s ease;
            border: 1px solid rgba(160, 200, 140, 0.3);
        }

        h2, h3 {
            text-align: center;
            color: #1e4a2e;        /* æ·±å¢¨ç»¿ */
            margin: 0 0 20px 0;
            font-weight: 600;
            letter-spacing: 0.5px;
            font-size: 1.6rem;
            text-shadow: 0 2px 4px rgba(200, 230, 180, 0.5);
        }

        h3 {
            font-size: 1.4rem;
            margin-bottom: 16px;
            color: #256635;
        }

        .input-group {
            margin-bottom: 22px;
        }

        label {
            display: block;
            font-size: 0.9rem;
            color: #1e562e;
            margin-bottom: 8px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #b8d9b0;
            border-radius: 24px;
            font-size: 1rem;
            transition: 0.2s;
            background: #ffffffec;
            -webkit-appearance: none;
            appearance: none;
            color: #1b3b1b;
        }

        input:focus {
            border-color: #4caf50;
            outline: none;
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.2);
            background: #ffffff;
        }

        .hint {
            font-size: 0.8rem;
            color: #3d6b3d;
            margin-top: 8px;
            padding-left: 10px;
        }

        .quick-selectors {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
            justify-content: center;
        }

        .selector {
            flex: 1 0 auto;
            background: #dcf2d0;        /* æµ…å«©ç»¿ */
            color: #1d4f1d;
            padding: 10px 12px;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 600;
            border: 2px solid transparent;
            cursor: pointer;
            transition: 0.2s;
            min-width: 70px;
            text-align: center;
            touch-action: manipulation;
            box-shadow: 0 4px 8px rgba(90, 140, 70, 0.1);
        }

        .selector:hover {
            background: #c0e0b0;
            transform: translateY(-2px);
            border-color: #a0c090;
        }

        .selector.active {
            background: #2a7a3a;          /* æ£®æ—ç»¿ */
            color: white;
            border-color: #1f662f;
            box-shadow: 0 6px 12px rgba(40, 110, 40, 0.3);
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin: 24px 0 16px;
            flex-wrap: wrap;
        }

        @media (max-width: 480px) {
            .button-group {
                flex-direction: column;
                gap: 10px;
            }
            .quick-selectors {
                gap: 6px;
            }
            .selector {
                padding: 8px 6px;
                font-size: 0.8rem;
            }
        }

        button {
            flex: 1 1 auto;
            background: #2f9e44;          /* æ´»åŠ›ç»¿ */
            border: none;
            color: white;
            padding: 16px 12px;
            border-radius: 40px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
            min-width: 120px;
            touch-action: manipulation;
            box-shadow: 0 10px 15px -8px #2d6a2d;
        }

        button:hover {
            background: #1f7b2e;
            transform: translateY(-3px);
            box-shadow: 0 16px 24px -8px #1f5a1f;
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 6px 10px -4px #1f5a1f;
        }

        /* æ¿€æ´»ç å±•ç¤ºåŒºåŸŸ */
        .result-area {
            background: #ecfbe8;
            border-radius: 28px;
            padding: 18px 14px;
            border: 2px dashed #7fb07f;
            text-align: center;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            color: #1a472a;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.4;
            box-shadow: inset 0 2px 6px #d0e8d0;
        }

        .error-message {
            color: #c44536;           /* ä¿ç•™æš–çº¢è‰²ï¼Œè¶³å¤Ÿæ˜¾çœ¼ */
            font-size: 0.9rem;
            text-align: center;
            margin-top: 10px;
            min-height: 24px;
            font-weight: 500;
        }

        .hidden {
            display: none;
        }

        /* åŠ¨æ€æç¤º/æ—¶é—´åŒºåŸŸ â€” æŠ¤çœ¼æµ…ç»¿åŸºè°ƒ */
        .copy-toast {
            margin: 12px 0;
            padding: 10px 16px;
            border-radius: 40px;
            text-align: center;
            font-size: 0.95rem;
            font-weight: 500;
            background: #daf0d0;          /* æŸ”å’Œç»¿ */
            color: #1d4f1d;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            border: 1px solid #b0d0a0;
            box-shadow: 0 4px 8px rgba(130, 170, 100, 0.15);
        }

        .copy-toast.success {
            background: #409c4e;          /* æ·±ä¸€ç‚¹çš„ç»¿ï¼Œä¿æŒå¯¹æ¯” */
            color: white;
            border-color: #2f7a3a;
        }

        .copy-toast.error {
            background: #d9534f;           /* æŸ”çº¢ï¼Œä½†ä¿ç•™ */
            color: white;
            border-color: #b13b37;
        }

        /* å¾®è°ƒå¯†ç é¡µé¢é£æ ¼ä¸€è‡´ */
        #passwordSection input {
            background: #f4fff0;
        }

        #passwordSubmit {
            background: #3a9445;
        }

        #passwordSubmit:hover {
            background: #2a7a32;
        }

        @media (max-width: 360px) {
            .card {
                padding: 20px 16px;
            }
            h2 {
                font-size: 1.4rem;
            }
            button {
                padding: 14px 10px;
                font-size: 1rem;
            }
            .selector {
                font-size: 0.75rem;
                padding: 8px 4px;
            }
        }

        /* ç¾åŒ–idè¾“å…¥æ¡†çš„å¢å‡æŒ‰é’® (éšè—é»˜è®¤ç®­å¤´ï¼Œä¿æŒå¹²å‡€) */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            opacity: 0.6;
            height: 24px;
        }
        /* ç«ç‹ */
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
    <div class="card">
        <div id="passwordSection">
            <h3>ğŸ”’ è¯·è¾“å…¥è®¿é—®å¯†ç </h3>
            <div class="input-group">
                <input type="password" id="passwordInput" placeholder="å¯†ç " autofocus>
            </div>
            <div class="button-group" style="margin-top:10px;">
                <button id="passwordSubmit">è¿›å…¥</button>
            </div>
            <div id="passwordError" class="error-message"></div>
        </div>

        <div id="generatorSection" class="hidden">
            <h2>ğŸŒ¿ æ¿€æ´»ç ç”Ÿæˆå™¨</h2>

            <div class="input-group">
                <label>æœºå™¨ç  <span>(ID)</span></label>
                <input type="number" id="idInput" placeholder="ä¾‹å¦‚ 10086">
            </div>

            <div class="input-group">
                <label>ğŸ“… å¿«æ·æœ‰æ•ˆæœŸ</label>
                <div class="quick-selectors" id="quickSelectors">
                    <button class="selector" data-days="1">æµ‹è¯•1å¤©</button>
                    <button class="selector" data-days="7">å‘¨å¡7å¤©</button>
                    <button class="selector" data-days="30">æœˆå¡30å¤©</button>
                    <button class="selector" data-days="90">å­£å¡90å¤©</button>
                    <button class="selector" data-days="365">å¹´å¡365å¤©</button>
                    <button class="selector" data-days="0">æ°¸ä¹…å¡</button>
                </div>
            </div>

            <div class="input-group">
                <label>âœï¸ è‡ªå®šä¹‰å¤©æ•° </label>
                <input type="number" id="daysInput" placeholder="è¾“å…¥å¤©æ•°" min="0" value="1">
                <div class="hint">tipï¼š0è¡¨ç¤ºæ— é™æœŸ</div>
            </div>

            <div class="button-group">
                <button id="generateBtn">âœ¨ ç”Ÿæˆæ¿€æ´»ç </button>
            </div>

            <!-- åŠ¨æ€åŒºåŸŸï¼šæ˜¾ç¤ºæ—¶é—´ æˆ– å¤åˆ¶åé¦ˆ (3ç§’åˆ‡æ¢) -->
            <div id="copyToast" class="copy-toast hidden"></div>

            <div class="result-area" id="resultDisplay">âœ¨ ç‚¹å‡»ã€ç”Ÿæˆæ¿€æ´»ç ã€‘</div>
        </div>
    </div>

    <script>
        (function() {
            // ---------- åŠ å¯†å›ºå®šå‚æ•° ----------
            const KEY_STRING = "Format2044153997";
            const KEY = CryptoJS.enc.Utf8.parse(KEY_STRING);
            const FIXED_KEY = 9411741;

            // ---------- DOM å…ƒç´  ----------
            const passwordSection = document.getElementById('passwordSection');
            const generatorSection = document.getElementById('generatorSection');
            const passwordInput = document.getElementById('passwordInput');
            const passwordSubmit = document.getElementById('passwordSubmit');
            const passwordError = document.getElementById('passwordError');
            const idInput = document.getElementById('idInput');
            const daysInput = document.getElementById('daysInput');
            const resultDisplay = document.getElementById('resultDisplay');
            const generateBtn = document.getElementById('generateBtn');
            const selectorButtons = document.querySelectorAll('.selector');
            const copyToast = document.getElementById('copyToast');

            // ---------- çŠ¶æ€å˜é‡ (æ—¶é—´/æç¤ºåˆ‡æ¢) ----------
            let currentMode = 'time';           // 'time' æˆ– 'toast'
            let timeInterval = null;             // æ—¶é’Ÿåˆ·æ–°å¥æŸ„
            let restoreTimer = null;              // 3ç§’æ¢å¤å®šæ—¶å™¨

            // ---------- å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–å½“å‰æ—¶é—´ (YYYY-MM-DD HH:MM:SS) ----------
            function formatNow() {
                const d = new Date();
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                const hours = String(d.getHours()).padStart(2, '0');
                const minutes = String(d.getMinutes()).padStart(2, '0');
                const seconds = String(d.getSeconds()).padStart(2, '0');
                return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
            }

            // ---------- æ›´æ–°æ—¶é—´æ˜¾ç¤º (ä»…å½“æ¨¡å¼ä¸ºtimeæ—¶æ›´æ–°å†…å®¹) ----------
            function updateTimeDisplay() {
                if (currentMode === 'time') {
                    copyToast.textContent = `ğŸ•’ å½“å‰æ—¶é—´ï¼š${formatNow()}`;
                }
            }

            // ---------- åœæ­¢æ‰€æœ‰å®šæ—¶å™¨ (æ—¶é’Ÿ + æ¢å¤å®šæ—¶å™¨) ----------
            function stopAllTimers() {
                if (timeInterval) {
                    clearInterval(timeInterval);
                    timeInterval = null;
                }
                if (restoreTimer) {
                    clearTimeout(restoreTimer);
                    restoreTimer = null;
                }
            }

            // ---------- å¯åŠ¨æ—¶é’Ÿ (åªæœ‰å¤„äºtimeæ¨¡å¼æ‰ä¼šçœŸæ­£åˆ·æ–°) ----------
            function startClock() {
                stopAllTimers();
                updateTimeDisplay();                    // ç«‹å³æ˜¾ç¤º
                timeInterval = setInterval(updateTimeDisplay, 1000);
            }

            // ---------- æ¢å¤æ—¶é—´æ˜¾ç¤ºæ¨¡å¼ (3ç§’åè°ƒç”¨) ----------
            function restoreTimeMode() {
                copyToast.classList.remove('success', 'error');
                currentMode = 'time';
                updateTimeDisplay();
                restoreTimer = null;
                if (!timeInterval) {
                    startClock();
                }
            }

            // ---------- æ˜¾ç¤ºä¸´æ—¶æç¤º (è¦†ç›–æ—¶é—´) å¹¶è®¾ç½®3ç§’è¿”å› ----------
            function showTemporaryMessage(message, isError = false) {
                if (restoreTimer) clearTimeout(restoreTimer);
                currentMode = 'toast';
                copyToast.textContent = message;
                copyToast.classList.remove('success', 'error');
                copyToast.classList.add(isError ? 'error' : 'success');
                restoreTimer = setTimeout(() => {
                    restoreTimeMode();
                }, 3000);
            }

            // ---------- å¯†ç éªŒè¯ (æ­£ç¡®åæ˜¾ç¤ºç”Ÿæˆå™¨ï¼Œå¯åŠ¨æ—¶é’Ÿ) ----------
            const CORRECT_PASSWORD = "199612";

            passwordSubmit.addEventListener('click', function() {
                const entered = passwordInput.value;
                if (entered === CORRECT_PASSWORD) {
                    passwordSection.classList.add('hidden');
                    generatorSection.classList.remove('hidden');
                    passwordError.textContent = '';

                    copyToast.classList.remove('hidden');
                    currentMode = 'time';
                    copyToast.classList.remove('success', 'error');
                    startClock();

                    idInput.focus();
                    resultDisplay.textContent = 'ğŸŒ± è¾“å…¥IDï¼Œç‚¹å‡»ç”Ÿæˆ';
                } else {
                    passwordError.textContent = 'âŒ å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥';
                    passwordInput.value = '';
                    passwordInput.focus();
                }
            });

            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    passwordSubmit.click();
                }
            });

            // ---------- æ¿€æ´»ç ç”Ÿæˆå‡½æ•° ----------
            function generateActivationCode() {
                const idStr = idInput.value.trim();
                if (idStr === '') return '';

                const idVal = parseInt(idStr, 10);
                if (isNaN(idVal)) return '';

                let daysVal = daysInput.value.trim() === '' ? 0 : parseInt(daysInput.value, 10);
                if (isNaN(daysVal) || daysVal < 0) daysVal = 0;

                const i3 = Math.floor(idVal / 2) + FIXED_KEY;
                const i3Hex = i3.toString(16);

                let plainText = i3Hex;
                if (daysVal > 0) {
                    const millis = daysVal * 86400000;
                    plainText = i3Hex + 'z' + millis;
                }

                const encrypted = CryptoJS.AES.encrypt(plainText, KEY, {
                    mode: CryptoJS.mode.ECB,
                    padding: CryptoJS.pad.Pkcs7
                });

                return encrypted.ciphertext.toString(CryptoJS.enc.Hex);
            }

            // ---------- å¤åˆ¶åˆ°å‰ªè´´æ¿ ----------
            function copyToClipboard(text) {
                return navigator.clipboard.writeText(text);
            }

            // ---------- ç”Ÿæˆå¹¶å¤åˆ¶ (ç‚¹å‡»ä¸»æŒ‰é’®) ----------
            function updateResultAndCopy() {
                const code = generateActivationCode();
                if (code) {
                    resultDisplay.textContent = code;
                    copyToClipboard(code)
                        .then(() => {
                            showTemporaryMessage('âœ… æ¿€æ´»ç å·²å¤åˆ¶', false);
                        })
                        .catch(() => {
                            showTemporaryMessage('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', true);
                        });
                } else {
                    resultDisplay.textContent = 'âš ï¸ è¯·è¾“å…¥æœ‰æ•ˆIDåç”Ÿæˆ';
                }
            }

            generateBtn.addEventListener('click', updateResultAndCopy);

            // å›è½¦è§¦å‘ç”Ÿæˆ
            idInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    generateBtn.click();
                }
            });

            // ---------- é«˜äº®ç®¡ç† (å¿«æ·å¤©æ•°) ----------
            function removeActiveClass() {
                selectorButtons.forEach(btn => btn.classList.remove('active'));
            }

            function setActiveByDay(dayValue) {
                removeActiveClass();
                if (dayValue === undefined || dayValue === null) return;
                const numericDay = typeof dayValue === 'number' ? dayValue : parseInt(dayValue, 10);
                if (isNaN(numericDay)) return;

                selectorButtons.forEach(btn => {
                    const btnDay = parseInt(btn.dataset.days, 10);
                    if (btnDay === numericDay) {
                        btn.classList.add('active');
                    }
                });
            }

            function syncActiveFromInput() {
                let rawValue = daysInput.value.trim();
                if (rawValue === '') {
                    setActiveByDay(0);
                } else {
                    const num = parseInt(rawValue, 10);
                    if (!isNaN(num) && num >= 0) {
                        setActiveByDay(num);
                    } else {
                        removeActiveClass();
                    }
                }
            }

            daysInput.addEventListener('input', syncActiveFromInput);

            // å¿«æ·æŒ‰é’®ä»…ä¿®æ”¹å¤©æ•°å’Œé«˜äº®
            selectorButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const days = this.dataset.days;
                    daysInput.value = days;
                    syncActiveFromInput();
                });
            });

            // åˆå§‹åŒ–é»˜è®¤1å¤©é«˜äº®
            daysInput.value = '1';
            setActiveByDay(1);
        })();
    </script>
</body>
</html>